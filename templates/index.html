<head>
    <meta charset="UTF-8">
    <title>Steam æ¸¸æˆé”€é‡é¢„æµ‹</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #1b2838;
            color: #c7d5e0;
            font-family: "Segoe UI", sans-serif;
        }

        .container {
            max-width: 900px;
            margin-top: 40px;
            background-color: #2a475e;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px #000;
        }

        h2 {
            color: #66c0f4;
        }

        .card {
            background-color: #1b2838;
            border: 1px solid #66c0f4;
            margin-bottom: 20px;
        }

        .card-header {
            background-color: #171a21;
            color: #66c0f4;
            font-weight: bold;
        }

        .form-control,
        .form-select,
        textarea {
            background-color: #2a475e;
            color: #ffffff;
            border: 1px solid #66c0f4;
        }

        .form-control::placeholder {
            color: #9aa7b8;
        }

        button.btn-primary {
            background-color: #66c0f4;
            border: none;
        }

        button.btn-success {
            background-color: #5cb85c;
            border: none;
        }

        button.btn-warning {
            background-color: #f0ad4e;
            border: none;
        }

        img {
            max-width: 100%;
            height: auto;
            margin-top: 15px;
            border-radius: 4px;
            border: 1px solid #c7d5e0;
        }

        .result-box {
            background-color: #2a475e;
            color: #c7d5e0;
            border: 1px solid #66c0f4;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 1.1em;
            text-align: center;
        }

        .form-control:focus,
        .form-select:focus,
        textarea:focus {
            background-color: #1b2838;
            /* æ·±è‰²èƒŒæ™¯ */
            color: #c7d5e0;
            /* å­—ä½“é¢œè‰² */
            border-color: #66c0f4;
            /* Steam è“è¾¹æ¡† */
            box-shadow: 0 0 0 0.2rem rgba(102, 192, 244, 0.25);
            /* æŸ”å’Œè“è‰²å¤–é˜´å½± */
        }
    </style>
</head>

<body>
    <div class="container">
        <h2 class="mb-4 text-center">ğŸ® Steam æ¸¸æˆé”€é‡é¢„æµ‹ç³»ç»Ÿ</h2>

        <!-- åŠŸèƒ½ 1: é€šè¿‡ Steam ID é¢„æµ‹ -->
        <div class="card mb-4">
            <div class="card-header">åŠŸèƒ½ä¸€ï¼šé€šè¿‡ Steam AppID è·å–å¹¶é¢„æµ‹</div>
            <div class="card-body">
                <input type="text" id="steamId" class="form-control mb-2" placeholder="è¯·è¾“å…¥ Steam AppID">
                <select id="modelSelect1" class="form-select mb-2">
                    <option value="LogisticRegression">Logistic Regression</option>
                    <!-- <option value="SGD">SGD</option> -->
                    <option value="RandomForest">Random Forest</option>
                    <option value="MLP">MLP</option>
                    <option value="LogisticRegression (No User Data)">Logistic Regression (No User Data)</option>
                    <!-- <option value="SGD (No User Data)">SGD (No User Data)</option> -->
                    <option value="RandomForest (No User Data)">Random Forest (No User Data)</option>
                    <option value="MLP (No User Data)">MLP (No User Data)</option>
                    <option value="DetailSalesPredictor">DetailSalesPredictor</option>
                    <option value="RandomForest (Updated)">Random Forest (Updated)</option>
                    <option value="MLP (Updated)">MLP (Updated)</option>
                </select>
                <button class="btn btn-primary" onclick="predictById()">é¢„æµ‹</button>
                <div id="result1" class="result-box mt-3"></div>
            </div>
        </div>

        <!-- åŠŸèƒ½ 2: æ‰‹åŠ¨è¾“å…¥ç‰¹å¾ -->
        <div class="card mb-4">
            <div class="card-header">åŠŸèƒ½äºŒï¼šæ‰‹åŠ¨è¾“å…¥ç‰¹å¾</div>
            <div class="card-body">
                <textarea id="featureInput" class="form-control mb-2" placeholder='è¯·è¾“å…¥ JSON æ ¼å¼ç‰¹å¾ï¼Œå¦‚ï¼š{"price": 9.99, "positive": 500, ...}' rows="5"></textarea>
                <select id="modelSelect2" class="form-select mb-2">
                    <option value="LogisticRegression">Logistic Regression</option>
                    <!-- <option value="SGD">SGD</option> -->
                    <option value="RandomForest">Random Forest</option>
                    <option value="MLP">MLP</option>
                    <option value="LogisticRegression (No User Data)">Logistic Regression (No User Data)</option>
                    <!-- <option value="SGD (No User Data)">SGD (No User Data)</option> -->
                    <option value="RandomForest (No User Data)">Random Forest (No User Data)</option>
                    <option value="MLP (No User Data)">MLP (No User Data)</option>
                    <option value="DetailSalesPredictor">DetailSalesPredictor</option>
                    <option value="RandomForest (Updated)">Random Forest (Updated)</option>
                    <option value="MLP (Updated)">MLP (Updated)</option>
                </select>
                <button class="btn btn-success" onclick="predictByFeatures()">é¢„æµ‹</button>
                <div id="result2" class="result-box mt-3"></div>
            </div>
        </div>

        <!-- åŠŸèƒ½ 3: å¢é‡è®­ç»ƒä¸Šä¼  -->
        <div class="card">
            <div class="card-header">åŠŸèƒ½ä¸‰ï¼šä¸Šä¼ æ–°æ•°æ®å¢é‡è®­ç»ƒæ¨¡å‹</div>
            <div class="card-body">
                <input type="file" id="fileInput" class="form-control mb-2">
                <select id="modelSelect3" class="form-select mb-2">
                    <option value="MLP">MLPï¼ˆå¢é‡æ›´æ–°ï¼‰</option>
                    <option value="RandomForest">Random Forestï¼ˆå…¨é‡æ›´æ–°ï¼‰</option>
                </select>
                <button class="btn btn-warning" onclick="uploadData()">ä¸Šä¼ å¹¶è®­ç»ƒ</button>
                <div id="result3" class="result-box mt-3"></div>
            </div>
        </div>
    </div>

    <script>
        async function predictById() {
            const id = document.getElementById("steamId").value;
            const model = document.getElementById("modelSelect1").value;
            const res = await fetch(`/predict_by_id?id=${id}&model=${model}`);
            const data = await res.json();

            let html = '';
            if (data.image_base64) {
                html += `<img src="data:image/jpeg;base64,${data.image_base64}" alt="å°é¢å›¾">`;
            }
            html += `<p><strong>é¢„æµ‹ç»“æœï¼š</strong> ${data.prediction}</p>`;
            document.getElementById("result1").innerHTML = html;
        }

        async function predictByFeatures() {
            const featuresText = document.getElementById("featureInput").value;
            const model = document.getElementById("modelSelect2").value;
            let features;
            try {
                features = JSON.parse(featuresText);
            } catch (e) {
                alert("JSON æ ¼å¼é”™è¯¯ï¼");
                return;
            }

            const res = await fetch('/predict_by_features', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ model, features })
            });

            const data = await res.json();
            let html = `<img src="/static/default.png" alt="é»˜è®¤å›¾">`;
            html += `<p><strong>é¢„æµ‹ç»“æœï¼š</strong> ${data.prediction}</p>`;
            document.getElementById("result2").innerHTML = html;
        }

        async function uploadData() {
            const fileInput = document.getElementById("fileInput");
            const model = document.getElementById("modelSelect3").value;

            if (fileInput.files.length === 0) {
                alert("è¯·é€‰æ‹©è¦ä¸Šä¼ çš„ CSV æ–‡ä»¶");
                return;
            }

            const formData = new FormData();
            formData.append("file", fileInput.files[0]);
            formData.append("model", model);

            const res = await fetch('/update_model', {
                method: 'POST',
                body: formData
            });

            const data = await res.json();
            let html = `<p>æ¨¡å‹å·²æ›´æ–°</p>`;
            if(data.accuracy){
                html += `<p>å‡†ç¡®ç‡ï¼š${data.accuracy}</p>`;
            }
            document.getElementById("result3").innerHTML = html;
        }
    </script>
</body>

</html>